language: node_js
node_js:
  - "0.12"

branches:
  only:
    - master

addons:
  ssh_known_hosts:
  - github.com

before_install:
  - openssl aes-256-cbc -K $encrypted_3ba5678e770b_key -iv $encrypted_3ba5678e770b_iv -in .travis/travis.enc -out ~/.ssh/id_rsa -d
  - chmod 600 ~/.ssh/id_rsa
  - eval $(ssh-agent)
  - ssh-add ~/.ssh/id_rsa
  - git config --global user.name "panjiabang"
  - git config --global user.email panjiabang@gmail.com

install:
  - npm install -g tiddlywiki

script:
  - tiddlywiki . --rendertiddler $:/core/save/all ./index.html text/plain
  - cp .travis/CNAME ./output/
  - cp .travis/favicon.png ./output/
  - git checkout gh-pages
  - cp -a ./output/* ./
  - rm -rf ./output
  - git add --all
  - git commit -m "$(curl -s whatthecommit.com/index.txt || echo no comment)"
  - git push -u origin gh-pages --force


